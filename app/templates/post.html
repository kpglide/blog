{% extends "base.html" %}

{% block content %}

<div id="form_container">
	
	<h3>Create a Post</h3>
	
	<form action="" method="post" name="blog_post_form">
	{{ form.hidden_tag() }}
	
		<div id="blog_post_form">
			<p>
				Title
				{% for error in form.errors.title %}
				<label class="blog_post_form_error">{{error}}</label>
				{% endfor %}
				<br><br>{{form.title(id="title_input")}}
			</p>
			<p>
				Body
				{% for error in form.errors.body %}
				<label class="blog_post_form_error">{{error}}</label>
				{% endfor %}
				<br>{{form.body}}
			</p>
			<p>
				<h3>Add an Image</h3>
					<div id="image_instructions">Paste your image's URL into the blank, or upload a new image by clicking Browse</div><br>

				
					<div>

						Image 1<br><br>

						<div class="image_input_div">

							<input type="file" id="file1" onchange="s3_upload('file1', 'image1_url', 'status1', 'preview1');"/>
							<p id="status1"></p>
							<div id="preview1"><img></div>

							url {{form.image1_url(class="image_url_input")}}

						</div>

					</div><br>

					<div>

						Image 2<br><br>

						<div class="image_input_div">

							<input type="file" id="file2" onchange="s3_upload('file2', 'image2_url', 'status2', 'preview2');"/>
							<p id="status2"></p>
							<div id="preview2"><img></div>

							url {{form.image2_url(class="image_url_input")}}

						</div>

					</div><br>

					<div>

						Image 3<br><br>

						<div class="image_input_div">

							<input type="file" id="file3" onchange="s3_upload('file3', 'image3_url', 'status3', 'preview3');"/>
							<p id="status3"></p>
							<div id="preview"><img></div>

							url {{form.image3_url(class="image_url_input")}}

						</div>

					</div>
			</p>
		</div>

		<div id="submit"><input type="submit" value="Submit Post"></div>
	


</div>

<script type="text/javascript" src="../static/s3upload.js"></script>

<script type="text/javascript">

function s3_upload(id, url_elem, status_elem, preview_elem){
    var status_elem = document.getElementById(status_elem);
    var url_elem = document.getElementById(url_elem);
    var preview_elem = document.getElementById(preview_elem);
    var file_elem = document.getElementById(id);
    var s3upload = new S3Upload({
        file_dom_selector: id,
        s3_sign_put_url: '/sign_s3/',
        s3_object_name: file_elem.value,

        onProgress: function(percent, message) {
            status_elem.innerHTML = 'Upload progress: ' + percent + '% ' + message;
        },
        onFinishS3Put: function(url) {
            status_elem.innerHTML = 'Upload completed. Uploaded to: '+ url;
            url_elem.value = url;
            preview_elem.innerHTML = '<img src="'+url+'" style="width:300px;" />';
        },
        onError: function(status) {
            status_elem.innerHTML = 'Upload error: ' + status;
        }
    });
}

</script>

{{ pagedown.include_pagedown() }}

{% endblock %}